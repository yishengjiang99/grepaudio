<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="../style.css">
  <link rel="stylesheet" href="../simple-console.css">
  <script src="../simple-console.js"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
</head>

<body>
<div>
  <canvas id='a'></canvas>
  <canvas id='b'></canvas>
  <canvas id='c'></canvas>
</div>
<div>
  <canvas id='a1'></canvas>
  <canvas id='a2'></canvas>
  <canvas id='a3'></canvas>

</div>
  <div id='ctrls'></div>
  <button>start</button>

  <script src='../polyfills.js'></script>
  <script type="module">
    import SharedBufferWorkletNode from './shared-buffer-worklet-node.js';
    import Mixer from '../Mixer.js';
    import { histogram2, chord,slider } from '../functions.js';


    $("button").onclick = async function (evt) {
      
      const ctx =await new AudioContext();
      window.g_audioCtx = ctx;
      await ctx.audioWorklet.addModule('./shared-buffer-worklet-processor.js');


      const sbwNode = new SharedBufferWorkletNode(ctx);

      sbwNode.onInitialized = async function (){
        let a = ctx.createAnalyser(), b = ctx.createAnalyser(), c = ctx.createAnalyser();
        let a1 = ctx.createAnalyser(), b2 = ctx.createAnalyser(), c3 = ctx.createAnalyser();

        var source = await chord("https://dsp.grepawk.com/samples/Piano");
       var lpf = ctx.createBiquadFilter();
        lpf.type='lowpass';
        lpf.frequency.setValueAtTime(300, ctx.currentTime)
        lpf.Q.value=1;
  
        var lhpf = ctx.createBiquadFilter();
        lhpf.type='highpass';
        lhpf.frequency.setValueAtTime(300, ctx.currentTime)
        lhpf.Q.value=1;
  
        // var hpf = ctx.createBiquadFilter();
        // hpf.type='highpass';
        // hpf.frequency.value=500;
        

        var d1 = ctx.createDelay();
        var d2  = ctx.createDelay();
        d1.delayTime.setValueAtTime(0.1, ctx.currentTime+0.0);
        d2.delayTime.setValueAtTime(0.1, ctx.currentTime+0.0);



        // sbwNode.connect(lpf).connect(d1).connect(a);
        source.connect(lpf).connect(d2).connect(a).connect(ctx.destination)
        source.connect(lhpf).connect(d1).connect(b).connect(ctx.destination);

 
  
        histogram2('a',a);
        histogram2('b',b);
        // histogram2('b',c);

      }
    }


  </script>
</body>

</html>
